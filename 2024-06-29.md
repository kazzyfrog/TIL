---
date created: 土曜日, 6月 29日 2024, 5:23:35 午後
date modified: 土曜日, 6月 29日 2024, 5:50:28 午後
---

## Next.js の next/image について

以下の、記事を読んだ：

- [画像最適化の舞台裏をのぞき見 👀 して next/image を使いこなす](https://zenn.dev/reiwatravel/articles/fb1586ea9463a1)

そもそも、Next.js の Image コンポーネントは、画像最適化を容易にし、Web パフォーマンスを向上させる強力なツール。
ポイントは、以下の通り：

## Image コンポーネント

- Image コンポーネントは、HTML の img タグをラップした React コンポーネントです。img タグと同様に src 属性で画像パスを指定し、alt 属性で代替テキストを設定します。
- Image コンポーネントは、単に<img>タグをラップするだけでなく、画像の最適化において重要な役割を果たします。特に、srcset 属性への複数の値の設定と loading="lazy" 属性の付与は、Web ページのパフォーマンス向上に大きく貢献します
- srcset 属性は、異なるデバイスの画面サイズや解像度に合わせて最適な画像を読み込むための仕組み。これを自動で設定する。
- loading="lazy" 属性は、画像の遅延読み込みを指定する属性。これも、自動的に<img>タグに付与します。
- 遅延読み込みとは、画面に表示される画像のみを読み込み、画面外の画像はスクロールされるまで読み込まないという仕組みです。これにより、初期表示に必要な画像のみが読み込まれるため、ページの初期表示速度が大幅に向上します。

## ローカル画像の扱い

- src props にローカルの画像を指定する場合に、２通りの方法が存在します。 一つは上の例に挙げたように画像のパスを相対パスで import して読み込む方法です。もう一つは [public ディレクトリからの絶対パスを src props に直接文字列として渡す方法](https://nextjs.org/docs/app/building-your-application/optimizing/static-assets) です
- 違いとして、相対パスで import した場合のみ、width と height を指定しなくても自動でサイズの割り当てを行ってくれる点があります。
- さらにキャッシュの設定に違いが生まれる。

## 画像最適な API

- 先ほどの例の srcset 属性、src 属性をみてみるとパスが  `/_next/image`  から始まっていることがわかります。これは、Next.js の画像最適化 API のエンドポイントです。`/_next/image`  にリクエストを送ると、この API は様々な処理を行い、最適化された画像をレスポンスとして返します。
- 具体的には、：
- 画像のリサイズ: クライアントのデバイスの画面サイズや解像度、Image コンポーネントの width、height、layout プロパティに応じて、最適なサイズの画像を生成します。
- 画像のフォーマット変換: クライアントのブラウザがサポートする最適な画像フォーマット（WebP、AVIF など）に変換します。これにより、ファイルサイズを大幅に削減し、読み込み速度を向上させることができます。
- 画質の最適化: 指定された画質（quality プロパティ）に応じて、画質を調整します。高画質な画像が必要な場合は高画質で、そうでない場合は低画質で配信することで、データ通信量を節約できます。
- キャッシュ: 生成した画像をキャッシュすることで、2 回目以降のリクエストにはキャッシュされた画像を即座に返すことができます。これにより、サーバーの負荷を軽減し、ページの表示速度を向上させることができます。
- これは、**React コンポーネントとしての next/image を利用せずとも、画像最適化 API のみだけで利用することも可能**だといえます。これを応用すればより詳細にカスタマイズ可能なアートディレクションを含む独自コンポーネントの作成も可能になります。
